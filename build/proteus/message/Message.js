// Generated by CoffeeScript 1.10.0
(function() {
  var CBOR, CipherMessage, DecodeError, DontCallConstructor, Message, PreKeyMessage, TypeUtil;

  CBOR = require('cbor-codec');

  DontCallConstructor = require('../errors/DontCallConstructor');

  TypeUtil = require('../util/TypeUtil');

  DecodeError = require('../errors/DecodeError');

  module.exports = Message = (function() {
    function Message() {
      throw new DontCallConstructor(this);
    }

    Message.prototype.serialise = function() {
      var e;
      e = new CBOR.Encoder();
      switch (false) {
        case !(this instanceof CipherMessage):
          e.u8(1);
          break;
        case !(this instanceof PreKeyMessage):
          e.u8(2);
          break;
        default:
          throw new TypeError('Unexpected message type');
      }
      this.encode(e);
      return e.get_buffer();
    };

    Message.deserialise = function(buf) {
      var d;
      TypeUtil.assert_is_instance(ArrayBuffer, buf);
      d = new CBOR.Decoder(buf);
      switch (d.u8()) {
        case 1:
          return CipherMessage.decode(d);
        case 2:
          return PreKeyMessage.decode(d);
        default:
          throw new DecodeError.InvalidType('Unrecognised message type');
      }
    };

    return Message;

  })();

  CipherMessage = require('./CipherMessage');

  PreKeyMessage = require('./PreKeyMessage');

}).call(this);
